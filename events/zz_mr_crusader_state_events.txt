country_event = {
	id = crusader_states_branching_mission_event

	title = crusader_states_branching_mission_event.t
	desc = crusader_states_branching_mission_event.d

	is_triggered_only = yes

	option = {
		name = crusader_states_branching_mission_event.a

		# Adds +2 shock +1 siege pips on top of the RNG to make the general not garbo, but 40 AT so he won't be like 3*
		create_general = {
			tradition = 40
			add_shock = 2
			add_siege = 1
		}

		define_advisor = {
			type = army_reformer
			cost_multiplier = 0.5
			skill = 1
		}

		custom_tooltip = crusader_states_branching_mission_event_A_TT

		set_country_flag = cs_domination_path

		swap_non_generic_missions = yes
	}

	option = {
		name = crusader_states_branching_mission_event.b

		add_country_modifier = {
			name = crusader_states_princely_diplomacy
			duration = 9125 # 25 years
		}

		define_advisor = {
			type = statesman
			cost_multiplier = 0.5
			skill = 1
		}

		custom_tooltip = crusader_states_branching_mission_event_B_TT

		set_country_flag = cs_diplomatic_path

		swap_non_generic_missions = yes
	}
}

country_event = {
	id = crusader_states_grand_wedding
	title = crusader_states_grand_wedding.t
	desc = crusader_states_grand_wedding.d

	is_triggered_only = yes

	major = yes

	major_trigger = {
		capital_scope = {
			superregion = near_east_superregion
		}
	}

	option = {
		name = crusader_states_grand_wedding.a

		add_years_of_income = -5
		every_known_country = {
			limit = {
				is_levantine_crusader_state = yes
			}
			add_trust = {
				who = root
				value = 20
			}
		}
	}

	option = {
		name = crusader_states_grand_wedding.b

		add_years_of_income = -3
		every_known_country = {
			limit = {
				is_levantine_crusader_state = yes
			}
			add_trust = {
				who = root
				value = 10
			}
		}
	}

	option = {
		name = crusader_states_grand_wedding.c

		add_years_of_income = 3
		every_known_country = {
			limit = {
				is_levantine_crusader_state = yes
			}
			add_trust = {
				who = root
				value = -5
			}
		}
	}
}


# Causes visible province event to fire that swaps to a better trade good
country_event = {
	id = crusader_states.3

	hidden = yes

	mean_time_to_happen = {
		years = 10

		modifier = {
			factor = 0.5
			stability = 2
		}
	}

	trigger = {
		is_levantine_crusader_state = yes
		mission_completed = cs_agricultural_centralization
		any_owned_province = {
			OR = {
				is_in_outremer = yes
				region = mashriq_region
			}
			OR = {
				has_farm_trade_goods = yes
				has_pasture_trade_goods = yes
			}
		}

	}

	immediate = {
		random_owned_province = {
			limit = {
				OR = {
					is_in_outremer = yes
					region = mashriq_region
				}
				OR = {
					has_farm_trade_goods = yes
					has_pasture_trade_goods = yes
				}
			}

			province_event = {
				id = crusader_states.4
			}
		}
	}

	option = {

	}
}

province_event = {
	id = crusader_states.4
	title = crusader_states.4.t
	desc = crusader_states.4.d
	picture = GFX_farm_estate

	is_triggered_only = yes

	option = {
		name = crusader_states.4.a
		change_trade_goods = sugar
	}

	option = {
		name = crusader_states.4.b
		change_trade_goods = tobacco
	}

	option = {
		name = crusader_states.4.c
		change_trade_goods = olives
	}

	option = {
		name = crusader_states.4.e
		change_trade_goods = dates_figs
	}
}

country_event = {
	id = crusader_states.5
	title = crusader_states.5.t
	desc = crusader_states.5.d
	picture = REBELLION_AGAINST_ANGLICANS_eventPicture

	is_triggered_only = yes

	option = {
		name = crusader_states.5.a

		inherit = ATI
		# every_owned_province = {
		# 	limit = {
		# 		is_core = ATI
		# 	}
		# 	add_nationalism = 10
		# }
	}
}

# Pulse event: new papal legate
# The following 3 events are triggered depending on the condition when the
# hidden event fires
country_event = {
	id = crusader_states_papal_legate_hidden
	title = crusader_states.6.t 
	desc = crusader_states.6.d 

	mean_time_to_happen = {
		years = 15
	}

	trigger = {
		is_levantine_crusader_state = yes
		religion = catholic
	}

	immediate = { # Pope loves us
		hidden_effect = {
			if = {
				limit = {
					PAP = { has_opinion = { who = root value = 100 } }
				}

				country_event = {
					id = crusader_states_papal_legate_good
				}
			}
			else_if = {
				limit = {
					PAP = { has_opinion = { who = root value = 0 } }
				}

				country_event = {
					id = crusader_states_papal_legate_neutral
				}
			}
			else = {
				country_event = {
					id = crusader_states_papal_legate_bad
				}
			}
		}
	}
}

country_event = {
	name = crusader_states_papal_legate_good
	title = crusader_states_papal_legate_good.t
	desc = crusader_states_papal_legate_good.d
	picture = POPE_PREACHING_eventPicture

	is_triggered_only = yes

	option = {
		name = crusader_states_papal_legate_good.a

		effect = {
			add_papal_influence = 25
			add_legitimacy = 5
		}
	}
}

country_event = {
	name = crusader_states_papal_legate_neutral
	title = crusader_states_papal_legate_neutral.t
	desc = crusader_states_papal_legate_neutral.d
	picture = POPE_PREACHING_eventPicture

	is_triggered_only = yes

	option = {
		name = crusader_states_papal_legate_neutral.a

		effect = {
			add_papal_influence = 5
		}
	}

	option = { # Special option for ruler traits
		name = crusader_states_papal_legate_neutral.b
		highlight = yes

		trigger = {
			OR = {
				ruler_has_personality = well_connected_personality
				ruler_has_personality = silver_tongue_personality
				ruler_has_personality = sinner_personality
			}
			NOT = {
				OR = {
					ruler_has_personality = pious_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = righteous_personality
				}
			}
		}
		
		effect = {
			add_treasury = -50
			add_papal_influence = 25

			hidden_effect = {
				add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
				reverse_add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
			}
		}
	}
}

country_event = {
	name = crusader_states_papal_legate_bad
	title = crusader_states_papal_legate_bad.t
	desc = crusader_states_papal_legate_bad.d
	picture = POPE_PREACHING_eventPicture

	is_triggered_only = yes

	option = { # Okay...
		name = crusader_states_papal_legate_bad.a

		effect = {
			add_papal_influence = -25
			add_legitimacy = -10
		}
	}

	option = { # Maybe we can do something about that...
		name = crusader_states_papal_legate_bad.b

		trigger = {
			NOT = {
				OR = {
					ruler_has_personality = pious_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = righteous_personality
				}
			}
		}
		
		effect = {
			add_treasury = -100
			add_papal_influence = 10

			hidden_effect = {
				add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
				reverse_add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
			}
		}
	}

	option = { # Special option for ruler traits
		name = crusader_states_papal_legate_bad.c
		highlight = yes

		trigger = {
			OR = {
				ruler_has_personality = well_connected_personality
				ruler_has_personality = silver_tongue_personality
				ruler_has_personality = sinner_personality
			}
			NOT = {
				OR = {
					ruler_has_personality = pious_personality
					ruler_has_personality = incorruptible_personality
					ruler_has_personality = righteous_personality
				}
			}
		}
		
		effect = {
			add_treasury = -50
			add_papal_influence = 50

			hidden_effect = {
				add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
				reverse_add_opinion = {
					who = PAP
					modifier = mr_crusaders_papal_legate_bribed
				}
			}
		}
	}
}